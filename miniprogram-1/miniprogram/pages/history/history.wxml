<!-- miniprogram/pages/history/history.wxml -->
<view class="history-container">
  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <view wx:if="{{isLoading && historyList.length === 0}}" class="loading-container">
    <view class="loading-spinner"></view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:elif="{{!isLoading && historyList.length === 0}}" class="empty-container">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-title">æš‚æ— è¯†åˆ«å†å²</text>
    <text class="empty-subtitle">å»é¦–é¡µè¯†åˆ«ä¸€æœµå…°èŠ±å§ï½</text>
  </view>

  <!-- å†å²åˆ—è¡¨ -->
  <view wx:else class="history-list">
    <view 
      class="history-item" 
      wx:for="{{historyList}}" 
      wx:key="_id"
      wx:for-item="item"
      wx:for-index="index"
    >
      <view class="item-header">
        <view class="item-main">
          <image 
            class="item-image" 
            src="{{item.imageUrl}}" 
            mode="aspectFill"
            data-url="{{item.imageUrl}}"
            bindtap="previewImage"
          ></image>
          <view class="item-content">
            <text class="item-title">{{item.result.name}}</text>
            <text class="item-subtitle">{{item.result.latin || 'Orchidaceae Family'}}</text>
            <view class="confidence-info">
              <view class="confidence-badge {{getConfidenceLevel(item.result.confidence)}}">
                ç½®ä¿¡åº¦ï¼š{{item.result.confidence >= 0.9 ? 'é«˜' : item.result.confidence >= 0.7 ? 'ä¸­' : 'ä½'}}
              </view>
              <text class="confidence-text">{{(item.result.confidence * 100)}}%</text>
            </view>
            <text class="item-time">{{formatTime(item.timestamp)}}</text>
          </view>
        </view>
        <view class="item-actions">
          <button 
            class="action-btn preview-btn" 
            data-url="{{item.imageUrl}}"
            bindtap="previewImage"
          >
            ğŸ‘ï¸
          </button>
          <button 
            class="action-btn delete-btn" 
            data-history-id="{{item._id}}"
            data-index="{{index}}"
            bindtap="deleteHistory"
          >
            ğŸ—‘ï¸
          </button>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{hasMore || isLoadingMore}}" class="load-more-container">
      <view wx:if="{{isLoadingMore}}" class="load-more-spinner"></view>
      <text class="load-more-text">
        {{isLoadingMore ? 'åŠ è½½ä¸­...' : 'ä¸Šæ‹‰åŠ è½½æ›´å¤š'}}
      </text>
    </view>
    
    <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
    <view wx:if="{{!hasMore && historyList.length > 0}}" class="load-more-container">
      <text class="load-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
    </view>
  </view>
</view>