<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨èƒŒæ™¯ -->
  <view class="top-bg">
    <view class="bg-pattern"></view>
    <view class="bg-gradient"></view>
  </view>

  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card">
    <view wx:if="{{hasUserInfo}}" class="user-info-logged">
      <view class="avatar-section">
        <!-- <view class="avatar-glow"></view> -->
        <!-- ä½¿ç”¨æ–°çš„å¤´åƒé€‰æ‹©å™¨ -->
        <button 
          class="avatar-button" 
          open-type="chooseAvatar" 
          bind:chooseavatar="onChooseAvatar"
        >
          <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="avatar-edit-hint">
            <text class="edit-text">ç‚¹å‡»æ›´æ¢</text>
          </view>
        </button>
        <view class="status-dot"></view>
      </view>
      <view class="user-content">
        <view class="user-main">
          <!-- ä½¿ç”¨æ–°çš„æ˜µç§°è¾“å…¥æ¡† -->
          <view class="nickname-wrapper">
            <input 
              wx:if="{{canIUseNicknameComp}}"
              class="nickname-input"
              type="nickname" 
              placeholder="è¯·è¾“å…¥æ˜µç§°"
              value="{{userInfo.nickName}}"
              bind:blur="onInputNickname"
            />
            <text wx:else class="username">{{userInfo.nickName}}</text>
          </view>
          <view class="user-badge">
            <text class="badge-text">VIP</text>
          </view>
        </view>
        <text class="user-desc">å…°èŠ±è¯†åˆ«ä¸“å®¶ Â· å·²è¯†åˆ«{{stats.totalRecognitions}}ç§</text>
      </view>
      <view class="settings-btn" bindtap="handleLogout">
        <view class="settings-icon"></view>
      </view>
    </view>
    
    <view wx:else class="user-info-guest">
      <view class="guest-avatar">
        <view class="avatar-placeholder">
          <text class="avatar-text">æœªç™»å½•</text>
        </view>
      </view>
      <view class="guest-content">
        <text class="guest-title">ç™»å½•è§£é”æ›´å¤šåŠŸèƒ½</text>
        <text class="guest-desc">ä¿å­˜è¯†åˆ«è®°å½• Â· æ”¶è—å…°èŠ±å“ç§ Â· ä¸ªæ€§åŒ–æ¨è</text>
        <button 
          class="login-button {{isLoading ? 'loading' : ''}}" 
          bindtap="handleLogin"
          disabled="{{isLoading}}"
        >
          <view wx:if="{{isLoading}}" class="loading-spinner"></view>
          <text>{{isLoading ? 'ç™»å½•ä¸­' : 'ç«‹å³ç™»å½•'}}</text>
        </button>
      </view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡å¡ç‰‡ -->
  <view wx:if="{{hasUserInfo}}" class="stats-card">
    <view class="stats-header">
      <text class="stats-title">æˆ‘çš„æ•°æ®</text>
      <view class="stats-icon">ğŸ“Š</view>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <view class="stat-circle stat-primary">
          <text class="stat-number">{{stats.totalRecognitions}}</text>
        </view>
        <text class="stat-label">æ€»è¯†åˆ«</text>
      </view>
      <view class="stat-item">
        <view class="stat-circle stat-success">
          <text class="stat-number">{{stats.accurateRecognitions}}</text>
        </view>
        <text class="stat-label">å‡†ç¡®è¯†åˆ«</text>
      </view>
      <view class="stat-item">
        <view class="stat-circle stat-warning">
          <text class="stat-number">{{stats.favoriteCount}}</text>
        </view>
        <text class="stat-label">æ”¶è—</text>
      </view>
      <view class="stat-item">
        <view class="stat-circle stat-info">
          <text class="stat-number">{{stats.usageDays}}</text>
        </view>
        <text class="stat-label">ä½¿ç”¨å¤©æ•°</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„åŠŸèƒ½</text>
      <view class="section-decoration"></view>
    </view>
    <view class="menu-grid">
      <view 
        class="menu-card" 
        wx:for="{{menuItems}}" 
        wx:key="id"
        data-item="{{item}}"
        bindtap="handleMenuItemTap"
      >
        <view class="menu-icon-wrapper">
          <image class="menu-icon" src="{{item.icon}}" mode="aspectFit"></image>
          <view wx:if="{{item.badge}}" class="menu-badge {{item.badge === 'new' ? 'badge-new' : 'badge-number'}}">
            {{item.badge}}
          </view>
        </view>
        <text class="menu-title">{{item.title}}</text>
        <view class="menu-arrow">â†’</view>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®èœå• -->
  <view class="settings-section">
    <view class="section-header">
      <text class="section-title">è®¾ç½®ä¸å¸®åŠ©</text>
      <view class="section-decoration"></view>
    </view>
    <view class="settings-list">
      <view 
        class="setting-item" 
        wx:for="{{settingItems}}" 
        wx:key="id"
        data-item="{{item}}"
        bindtap="handleSettingItemTap"
      >
        <view class="setting-left">
          <view class="setting-icon-bg">
            <image class="setting-icon" src="{{item.icon}}" mode="aspectFit"></image>
          </view>
          <text class="setting-text">{{item.title}}</text>
        </view>
        <view class="setting-arrow">
          <text class="arrow-text">â€º</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨ä¿¡æ¯ -->
  <view class="footer">
    <view class="app-info">
      <view class="app-logo">ğŸŒº</view>
      <view class="app-details">
        <text class="app-name">æ™ºèƒ½å…°èŠ±è¯†åˆ«</text>
        <text class="app-version">v1.0.0</text>
      </view>
    </view>
    <text class="copyright">Â© 2024 æŠ€æœ¯æ”¯æŒ Â· å¾®ä¿¡äº‘å¼€å‘</text>
  </view>

  <!-- è£…é¥°å…ƒç´  -->
  <view class="decoration decoration-1"></view>
  <view class="decoration decoration-2"></view>
  <view class="decoration decoration-3"></view>
</view>